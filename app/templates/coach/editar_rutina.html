<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Editar Rutina</title>
<style>
     body { background:#0f0f0f; color:#e6e6e6; font-family:Arial; padding:30px; }
     
     .card {
         background:#1a1a1a; 
         padding:20px; 
         border-radius:12px;
         border:1px solid #333;
         max-width:600px;
         margin:auto; 
         position: relative;
     }
     
     input, textarea { 
        width:100%; 
        padding:10px; 
        margin-top:10px; 
        border-radius:8px; 
        border:1px solid #333;
        background:#0f0f0f;
        color:white; 
     }
     
     button { 
        margin-top:15px;
        padding:10px;
        width:100%;
        background:#00d4ff;
        border:none;
        border-radius:8px;
        font-weight:bold; 
     }
     
     .ejercicio { 
        background:#111;
        padding:10px;
        border-radius:8px;
        margin-top:10px;
        border:1px solid #333; 
     }

     /* Caja de sugerencias */
     .sugerencias {
        background:#1a1a1a;
        border:1px solid #333;
        border-radius:8px;
        margin-top:5px;
        display:none;
        position:absolute;
        width:100%;
        z-index:20;
     }
     .sugerencias div {
        padding:10px;
        cursor:pointer;
     }
     .sugerencias div:hover {
        background:#00d4ff;
        color:black;
     }
</style>
</head>

<body>
<div class="card">
    <h2>Agregar ejercicios</h2>

    <form method="POST">
        
        <label>D√≠a</label>
        <select name="dia">
            <option value="Lunes">Lunes</option>
            <option value="Martes">Martes</option>
            <option value="Mi√©rcoles">Mi√©rcoles</option>
            <option value="Jueves">Jueves</option>
            <option value="Viernes">Viernes</option>
            <option value="S√°bado">S√°bado</option>
            <option value="Domingo">Domingo</option>
        </select>

        <label>Nombre del ejercicio</label>
        <input type="text" id="nombre" name="nombre" autocomplete="off" required>

        <!-- Caja de sugerencias -->
         <div id="sugerencias" class="sugerencias"></div>

        <label>Series</label>
        <input type="number" name="series">

        <label>Repeticiones</label>
        <input type="text" name="repeticiones">

        <label>Peso sugerido</label>
        <input type="text" name="peso">

        <label>Notas</label>
        <textarea name="notas"></textarea>

        <button type="submit">Agregar ejercicio</button>
    </form>

    <h3>Ejercicios agregados</h3>

    {% set dias = ["Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes", "S√°bado", "Domingo"] %}

    {% for d in dias %}
       <h2 style="margin-top:25px; color:#00d4ff;">{{ d }}</h2>

       {% set ejercicios_dia = dias_dict.get(d, []) %}

        <table style="width:100%; border-collapse:collapse; margin-top:10px;">
            <tr style="background:#222;">
                <th style="padding:8px; border:1px solid #333;">Ejercicio</th>
                <th style="padding:8px; border:1px solid #333;">Series</th>
                <th style="padding:8px; border:1px solid #333;">Reps</th>
                <th style="padding:8px; border:1px solid #333;">Peso</th>
                <th style="padding:8px; border:1px solid #333;">Notas</th>
                <th style="padding:8px; border:1px solid #333;">Acciones</th>
            </tr>

           

            {% if ejercicios_dia %}
                {% for e in ejercicios_dia %}
                    <tr>
                        <td style="padding:8px; border:1px solid #333;">{{ e[2] }}</td>
                        <td style="padding:8px; border:1px solid #333;">{{ e[3] }}</td>
                        <td style="padding:8px; border:1px solid #333;">{{ e[4] }}</td>
                        <td style="padding:8px; border:1px solid #333;">{{ e[5] if e[5] else "‚Äî" }}</td>
                        <td style="padding:8px; border:1px solid #333;">{{ e[6] if e[6] else "‚Äî" }}</td>

                        <td style="padding:8px; border:1px solid #333; text-align:center;">

                            <!-- Bot√≥n editar -->
                            <a href="/editar_ejercicio/{{ e[0] }}"
                                 style="background:#ffaa00; padding:5px 8px; border-radius:6px; text-decoration:none; color:black; margin-right:5px;">
                                 ‚úèÔ∏è
                            </a>

                            <!-- Bot√≥n eliminar -->
                            <form method="POST" action="/eliminar_ejercicio" style="display:inline;">
                                <input type="hidden" name="id" value="{{ e[0] }}">
                                <button style="background:#ff4444; padding:5px 8px; border:none; border-radius:6px; cursor:pointer;">
                                     üóëÔ∏è
                                </button>
                            </form>

                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="6" style="padding:8px; border:1px solid #333; color:#666;"> 
                        No hay ejercicios para este d√≠a.
                    </td>
                </tr>
            {% endif %}
        </table>
    {% endfor %}

<script>
const input = document.getElementById("nombre");
const box = document.getElementById("sugerencias");

input.addEventListener("input", async () => {
    const q = input.value.trim();

    if (q.length < 2) {
        box.style.display = "none";
        return;
    }

    const res = await fetch(`/buscar_ejercicios?q=${q}`);
    const data = await res.json();

    box.innerHTML = "";

    if (data.resultados.length === 0) {
        box.style.display = "none";
        return;
    }

    data.resultados.forEach(ej => {
        const div = document.createElement("div");
        div.textContent = ej;
        div.onclick = () => {
            input.value = ej;
            box.style.display = "none";
        };
        box.appendChild(div);
    });

    box.style.display = "block";
});
input.addEventListener("blur", () => {
     setTimeout(() => box.style.display = "none", 150);
});
</script>

</body>
</html>
